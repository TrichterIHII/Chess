<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>Schach ohne Bilder</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #000;
    color: #9cf;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #board {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    grid-template-rows: repeat(8, 1fr);
    width: 95vw;
    max-width: 400px;
    aspect-ratio: 1 / 1;
    margin: 20px 0;
    border: 2px solid #0af;
  }
  .square {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    user-select: none;
    cursor: pointer;
  }
  .light { background: #9cf; color: #000; }
  .dark { background: #024; color: #fff; }
  #controls {
    width: 95vw;
    max-width: 400px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 20px;
  }
  select, button {
    width: 100%;
    padding: 12px;
    font-size: 1rem;
    border: none;
    border-radius: 6px;
    background: #024;
    color: #9cf;
  }
  button {
    background: #06c;
    color: #fff;
    font-weight: bold;
  }
  button:active { background: #048; }
  pre {
    background: #111;
    color: #0cf;
    padding: 10px;
    border-radius: 6px;
    overflow-x: auto;
    font-size: 0.9rem;
  }
</style>
</head>
<body>

<div id="board"></div>

<div id="controls">
  <label>Seite:
    <select id="side">
      <option value="white" selected>Weiß (du)</option>
      <option value="black">Schwarz (du)</option>
    </select>
  </label>

  <label>Stärke:
    <select id="strength">
      <option value="1">1 (leicht)</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10 (Stockfish)</option>
    </select>
  </label>

  <button id="newBtn">Neues Spiel</button>
  <button id="undoBtn">Rückgängig</button>

  <strong>Letzter Zug:</strong>
  <pre id="lastMove">-</pre>

  <strong>Notierung (PGN):</strong>
  <pre id="pgn">-</pre>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.13.4/chess.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stockfish/stockfish.js"></script>
<script>
const game = new Chess();
const boardEl = document.getElementById("board");
const lastMoveEl = document.getElementById("lastMove");
const pgnEl = document.getElementById("pgn");
const sideSelect = document.getElementById("side");
const strengthSelect = document.getElementById("strength");
const stockfish = Stockfish();

const pieceSymbols = {
  p: "♙", n: "♘", b: "♗", r: "♖", q: "♕", k: "♔",
  P: "♟", N: "♞", B: "♝", R: "♜", Q: "♛", K: "♚"
};

function renderBoard() {
  boardEl.innerHTML = "";
  const board = game.board();
  for (let r = 0; r < 8; r++) {
    for (let c = 0; c < 8; c++) {
      const sq = document.createElement("div");
      sq.classList.add("square");
      if ((r + c) % 2 === 0) sq.classList.add("light");
      else sq.classList.add("dark");
      const piece = board[r][c];
      if (piece) {
        const sym = piece.color === "w" ? pieceSymbols[piece.type] : pieceSymbols[piece.type.toUpperCase()];
        sq.textContent = sym;
      }
      const squareName = "abcdefgh"[c] + (8 - r);
      sq.dataset.square = squareName;
      sq.onclick = () => onSquareClick(squareName);
      boardEl.appendChild(sq);
    }
  }
  pgnEl.textContent = game.pgn() || "-";
}

let selectedSquare = null;
function onSquareClick(square) {
  if (selectedSquare) {
    const move = game.move({ from: selectedSquare, to: square, promotion: "q" });
    if (move) {
      updateUI(move);
      selectedSquare = null;
      setTimeout(maybeBotMove, 200);
    } else {
      selectedSquare = null;
    }
  } else {
    selectedSquare = square;
  }
  renderBoard();
}

function updateUI(move) {
  lastMoveEl.textContent = move ? move.san : "-";
}

function startNew() {
  game.reset();
  updateUI(null);
  renderBoard();
  if (sideSelect.value === "black") setTimeout(maybeBotMove, 300);
}

function undoMove() {
  game.undo(); game.undo();
  renderBoard();
  updateUI(null);
}

function maybeBotMove() {
  if (game.game_over()) return;
  const playerSide = sideSelect.value;
  const botColor = playerSide === "white" ? "b" : "w";
  if (game.turn() !== botColor) return;
  const strength = parseInt(strengthSelect.value, 10);
  if (strength < 10) {
    const moves = game.moves();
    const move = moves[Math.floor(Math.random() * moves.length)];
    game.move(move);
    updateUI({ san: move });
    renderBoard();
  } else {
    stockfish.postMessage("position fen " + game.fen());
    stockfish.postMessage("go depth 12");
  }
}

stockfish.onmessage = function(event) {
  const line = (typeof event === "string") ? event : event.data;
  if (line.startsWith("bestmove")) {
    const parts = line.split(" ");
    if (parts[1] && parts[1] !== "(none)") {
      const move = game.move({ from: parts[1].substr(0,2), to: parts[1].substr(2,2), promotion: "q" });
      updateUI(move);
      renderBoard();
    }
  }
};

document.getElementById("newBtn").onclick = startNew;
document.getElementById("undoBtn").onclick = undoMove;

startNew();
</script>
</body>
</html>
